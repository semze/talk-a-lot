<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Talk-a-lot — Firebase Single-File Demo (RTDB included)</title>
  <style>
    :root { --bg:#f6f8fa; --card:#fff; --muted:#666; --accent:#0366d6; }
    body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;margin:0;padding:2rem;background:var(--bg);color:#111}
    main{max-width:900px;margin:0 auto;background:var(--card);padding:1.5rem;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h1{margin:.25rem 0}
    section{margin-top:1rem}
    button{padding:.5rem .8rem;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
    button:hover{background:#f0f0f0}
    footer{margin-top:1.25rem;font-size:.9rem;color:var(--muted)}
    code{background:#f3f4f6;padding:.15rem .3rem;border-radius:4px;font-size:.92em}
    .row{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}
    pre{background:#f8f9fb;padding:.6rem;border-radius:6px;overflow:auto}
  </style>
</head>
<body>
  <main>
    <h1>Talk-a-lot — Firebase Single-File Demo (RTDB included)</h1>
    <p id="status">Initializing Firebase...</p>

    <section>
      <h2>Auth</h2>
      <div class="row">
        <button id="anonSignIn">Sign in anonymously</button>
        <button id="signOut" style="display:none">Sign out</button>
      </div>
      <p id="userInfo">—</p>
    </section>

    <section>
      <h2>Firestore test</h2>
      <div class="row">
        <button id="writeTest">Write test document (Firestore)</button>
        <span id="writeResult" style="margin-left:.5rem;color:var(--muted)"></span>
      </div>
      <p style="margin-top:.5rem;color:var(--muted)">Writes go to collection <code>public_demo_logs</code>.</p>
    </section>

    <section>
      <h2>Realtime Database test</h2>
      <div class="row">
        <button id="rdbWrite">Write to RTDB</button>
        <button id="rdbRead">Read latest RTDB</button>
        <span id="rdbResult" style="margin-left:.5rem;color:var(--muted)"></span>
      </div>
      <pre id="rdbOutput" style="margin-top:.5rem;max-height:160px"></pre>
      <p style="margin-top:.5rem;color:var(--muted)">RTDB path used: <code>/public_demo_logs_rtdb</code></p>
    </section>

    <footer>
      <p>This is a single-file static demo. Place this file in a <code>docs/</code> folder, push to main, and enable GitHub Pages (main /docs).</p>
      <p style="color:var(--muted)">Note: This embeds client Firebase config (web API key). Do NOT embed admin/service-account secrets in client code.</p>
    </footer>
  </main>

  <script type="module">
    // Firebase v9 modular via CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getDatabase, ref as rdbRef, push as rdbPush, get as rdbGet, query as rdbQuery, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // === EMBEDDED FIREBASE CONFIG (includes databaseURL) ===
    // Use the Realtime Database URL from your Firebase console (Realtime Database panel).
    const firebaseConfig = {
      apiKey: "AIzaSyD2Q2TDCQDVcmmhR7zzVVTMtBkaS40cOx0",
      authDomain: "talk-a-lot-5aad8.firebaseapp.com",
      projectId: "talk-a-lot-5aad8",
      storageBucket: "talk-a-lot-5aad8.firebasestorage.app",
      messagingSenderId: "373420699612",
      appId: "1:373420699612:web:11f4470e6e0097b6576919",
      measurementId: "G-P0VNPFJ2HD",
      // Add the Realtime Database URL exactly as shown in the Firebase console:
      databaseURL: "https://talk-a-lot-5aad8-default-rtdb.firebaseio.com"
    };
    // ====================================================

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    // Use getDatabase(app) — because we provided databaseURL it will connect correctly
    const rdb = getDatabase(app);

    // UI refs
    const statusEl = document.getElementById('status');
    const userInfoEl = document.getElementById('userInfo');
    const anonBtn = document.getElementById('anonSignIn');
    const signOutBtn = document.getElementById('signOut');
    const writeBtn = document.getElementById('writeTest');
    const writeResult = document.getElementById('writeResult');
    const rdbWriteBtn = document.getElementById('rdbWrite');
    const rdbReadBtn = document.getElementById('rdbRead');
    const rdbResult = document.getElementById('rdbResult');
    const rdbOutput = document.getElementById('rdbOutput');

    statusEl.textContent = 'Firebase initialized for project: ' + (firebaseConfig.projectId || '(unknown)');

    // Auth handlers
    anonBtn.addEventListener('click', async () => {
      anonBtn.disabled = true;
      try { await signInAnonymously(auth); }
      catch (err) { userInfoEl.textContent = 'Sign-in error: ' + err.message; }
      finally { anonBtn.disabled = false; }
    });
    signOutBtn.addEventListener('click', async () => {
      signOutBtn.disabled = true;
      try { await signOut(auth); } catch (err) { userInfoEl.textContent = 'Sign-out error: ' + err.message; }
      signOutBtn.disabled = false;
    });
    onAuthStateChanged(auth, user => {
      if (user) {
        userInfoEl.textContent = `Signed in — uid=${user.uid} (isAnonymous=${user.isAnonymous})`;
        anonBtn.style.display = 'none';
        signOutBtn.style.display = 'inline-block';
      } else {
        userInfoEl.textContent = 'Not signed in';
        anonBtn.style.display = 'inline-block';
        signOutBtn.style.display = 'none';
      }
    });

    // Firestore test
    writeBtn.addEventListener('click', async () => {
      writeResult.textContent = 'Writing…';
      writeBtn.disabled = true;
      try {
        const ref = await addDoc(collection(db, 'public_demo_logs'), {
          message: 'Hello from GitHub Pages demo (Firestore)',
          createdAt: serverTimestamp()
        });
        writeResult.textContent = `Wrote: ${ref.id}`;
      } catch (err) {
        writeResult.textContent = 'Write failed: ' + err.message + ' (check Firestore rules)';
      } finally { writeBtn.disabled = false; }
    });

    // RTDB write (push)
    rdbWriteBtn.addEventListener('click', async () => {
      rdbResult.textContent = 'Writing to RTDB���';
      rdbWriteBtn.disabled = true;
      try {
        const nodeRef = rdbRef(rdb, 'public_demo_logs_rtdb');
        const newRef = await rdbPush(nodeRef, {
          message: 'Hello from GitHub Pages demo (RTDB)',
          ts: Date.now()
        });
        rdbResult.textContent = `Pushed: ${newRef.key}`;
      } catch (err) {
        rdbResult.textContent = 'RTDB write failed: ' + err.message + ' (check RTDB rules & databaseURL)';
      } finally { rdbWriteBtn.disabled = false; }
    });

    // RTDB read (get last item)
    rdbReadBtn.addEventListener('click', async () => {
      rdbOutput.textContent = '';
      rdbResult.textContent = 'Reading…';
      rdbReadBtn.disabled = true;
      try {
        const nodeRef = rdbRef(rdb, 'public_demo_logs_rtdb');
        const q = rdbQuery(nodeRef, limitToLast(5));
        const snap = await rdbGet(q);
        if (snap.exists && typeof snap.forEach === 'function') {
          const out = [];
          snap.forEach(child => { out.push({ key: child.key, val: child.val() }); });
          rdbOutput.textContent = JSON.stringify(out, null, 2);
          rdbResult.textContent = `Read ${out.length} item(s)`;
        } else {
          rdbOutput.textContent = JSON.stringify(snap.val(), null, 2);
          rdbResult.textContent = snap.exists() ? 'Read' : 'No data';
        }
      } catch (err) {
        rdbResult.textContent = 'RTDB read failed: ' + err.message;
      } finally { rdbReadBtn.disabled = false; }
    });

    console.log('Firebase initialized (client):', { projectId: firebaseConfig.projectId, databaseURL: firebaseConfig.databaseURL });
  </script>
</body>
</html>
